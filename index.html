<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>P1 Dictation – Paper Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body {margin:0;background:linear-gradient(#B2EBF2,#81D4FA);font-family:-apple-system,sans-serif;height:100vh;width:100vw;overflow:hidden;display:flex;align-items:center;justify-content:center;}
  #landing {text-align:center;width:100%;}
  h1 {font-size:11vw;color:#004D40;margin-bottom:8vh;}
  .btn {padding:6vw 18vw;margin:6vh auto;font-size:9vw;border:none;border-radius:30px;color:white;box-shadow:0 12px 35px rgba(0,0,0,0.4);cursor:pointer;}
  #studyBtn {background:#26A69A;}
  #dictateBtn {background:#FF9800;}
  
  #game {display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:#B2EBF2;padding-top:5vh;text-align:center;}
  
  /* Made card slightly bigger since there is no input box now */
  #card {background:#009688;color:white;width:88vw;height:55vh;margin:5vh auto;border-radius:40px;display:flex;align-items:center;justify-content:center;font-size:11vw;font-weight:bold;box-shadow:0 20px 50px rgba(0,0,0,0.4);padding: 20px; box-sizing: border-box; word-wrap: break-word;}
  #card.sentence {font-size:7vw; line-height: 1.2;}
  
  #bottom {position:fixed;bottom:6vh;left:50%;transform:translateX(-50%);background:rgba(0,77,64,0.98);border-radius:40px;padding:3vh 6vw;display:flex;gap:6vw;box-shadow:0 15px 40px rgba(0,0,0,0.5); z-index: 100;}
  #bottom button {background:transparent;color:white;border:none;font-size:7vw;font-weight:bold;cursor:pointer; min-width: 18vw;}
  #bottom button.hidden {display:none;}
  
  canvas {position:fixed;top:0;left:0;pointer-events:none;z-index:999;}
</style>
</head>
<body>

<div id="landing">
  <h1>P1 Dictation</h1>
  <button class="btn" id="studyBtn">Study Mode</button>
  <button class="btn" id="dictateBtn">Dictation Mode</button>
</div>

<div id="game">
  <div id="card">Ready</div>
  
  <div id="bottom">
    <button id="playBtn" onclick="play()">Play</button>
    <button id="revealBtn" onclick="reveal()">Reveal</button>
    <button onclick="next()">Next</button>
    <button onclick="location.reload()">Menu</button>
  </div>
</div>

<canvas id="confetti"></canvas>
<audio id="clap" src="https://www.soundjay.com/human/applause-01.mp3"></audio>

<script>
const words = [
  "o","s","m","h",
  "one","four","nine","they","what","has","have","and","play","our",
  "This is a desk.","This is a bookshelf.","This is a computer.",
  "She has two sharpeners.","Tom has three rulers and six erasers.",
  "We have three pens.","They have five school bags."
];

let i = -1;
let mode = "";

document.getElementById('studyBtn').onclick = () => start('study');
document.getElementById('dictateBtn').onclick = () => start('dictate');

function start(m) {
  mode = m;
  document.getElementById('landing').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  i = -1; 
  
  // Logic: Study Mode = Play Button YES, Reveal Button NO
  // Dictation Mode = Play Button YES, Reveal Button YES
  document.getElementById('playBtn').classList.remove('hidden'); 
  
  if (mode === 'study') {
    document.getElementById('revealBtn').classList.add('hidden');
  } else {
    document.getElementById('revealBtn').classList.remove('hidden');
  }
  next();
}

function play() {
  const utter = new SpeechSynthesisUtterance(words[i]);
  utter.lang = 'en-GB';
  utter.rate = 0.7;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
  
  // Only hide text if we are effectively testing
  if (mode === 'dictate') {
    // If the card is already revealed, don't hide it again!
    if (document.getElementById('card').style.background !== 'rgb(0, 150, 136)') { 
         // Logic: #009688 is the 'reveal' color. If it's not revealed, show listening.
         // Actually simpler: just show listening if we haven't revealed yet.
    }
    // But simplest for now:
    // If text is NOT the word, show listening.
    if (document.getElementById('card').textContent !== words[i]) {
        document.getElementById('card').textContent = '(listening…)';
        document.getElementById('card').style.background = '#004D40';
    }
  }
}

function reveal() {
  document.getElementById('card').textContent = words[i];
  document.getElementById('card').className = words[i].length > 10 ? 'card sentence' : 'card';
  document.getElementById('card').style.background = '#009688'; 
  // Removed clap here. It's better to clap at the END of the test.
}

function next() {
  i++;
  
  // Loop check
  if (i >= words.length) {
     i = 0; // Loop back to start
     confetti();
     document.getElementById('clap').play();
     // You could add an alert here: alert("Good job! Starting over.");
  }

  if (mode === 'study') {
    document.getElementById('card').textContent = words[i];
    document.getElementById('card').className = words[i].length > 10 ? 'card sentence' : 'card';
    document.getElementById('card').style.background = '#009688';
  } else {
    document.getElementById('card').textContent = 'Press Play';
    document.getElementById('card').style.background = '#009688';
    document.getElementById('card').className = 'card';
  }
}

function confetti() {
  const c = document.getElementById('confetti'); c.style.display='block';
  c.width = innerWidth; c.height = innerHeight;
  const ctx = c.getContext('2d');
  const p = [];
  for(let j=0;j<400;j++) p.push({x:Math.random()*c.width,y:Math.random()*c.height-100,c:`hsl(${Math.random()*360},100%,50%)`,s:Math.random()*10+6});
  let t=0;
  const anim = setInterval(()=>{ctx.clearRect(0,0,c.width,c.height);p.forEach(o=>{o.y+=o.s;if(o.y>c.height)o.y=-30;ctx.fillStyle=o.c;ctx.fillRect(o.x+Math.sin(t)*15,o.y,14,14);});t+=0.1;},20);
  setTimeout(()=>{clearInterval(anim);c.style.display='none';},5000);
}
</script>
</body>
</html>
